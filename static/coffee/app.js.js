// Generated by CoffeeScript 1.9.3
(function() {
  $(function() {
    var $ContactForm, $body, $contactFormName, $cta, $ctaOpener, $forms, $header, $slider, $subscribeEmail, $subscribeSubmit, adjustShowingOfCta, ctaOpened, newlsetterHiddenClass, scrolled, toCheck;

    newlsetterHiddenClass = 'newsletter__submit--hidden';
    $subscribeSubmit = $('#SignupSubmit').addClass(newlsetterHiddenClass);
    $subscribeEmail = $('#mce-EMAIL');
    $subscribeEmail.keyup(function(e) {
      var email;
      email = $.trim($(e.target).val());
      console.log(email);
      if (email === '') {
        return $subscribeSubmit.addClass(newlsetterHiddenClass);
      } else {
        $subscribeSubmit.removeClass(newlsetterHiddenClass);
        if (email.match(/[^@]+@[^@]+\.[^@]+/)) {
          return $subscribeSubmit.find('input').removeAttr('disabled');
        } else {
          return $subscribeSubmit.find('input').attr('disabled', 'disabled');
        }
      }
    });

    $cta = $('#Cta');
    $body = $('body');
    $header = $('.header');
    adjustShowingOfCta = function() {
      var margin, max, min, offset, scroll;
      max = -4.5;
      min = 0;
      offset = ($body.height() - $header.height()) / 3;
      scroll = window.pageYOffset;
      if (scroll <= 0) {
        margin = max;
      } else if (scroll >= offset) {
        margin = min;
      } else {
        margin = ((offset - scroll) / offset) * max;
      }
      return $cta.css('right', margin + "em");
    };

    scrolled = false;
    $(window).scroll(function() {
      return scrolled = true;
    });
    setInterval(function() {
      if (scrolled) {
        scrolled = false;
        return adjustShowingOfCta();
      }
    }, 150);
    ctaOpened = false;
    $ctaOpener = $cta.find('#CtaOpener');
    $ctaOpener.click(function(e) {
      var cls, old;
      if ($body.width() >= 800) {
        e.preventDefault();
        cls = 'quick-contact--opened';
        if (ctaOpened) {
          $cta.removeClass(cls);
        } else {
          $cta.addClass(cls);
        }
        ctaOpened = !ctaOpened;
        old = $ctaOpener.text();
        $ctaOpener.text($ctaOpener.data('alt'));
        return $ctaOpener.data('alt', old);
      }
    });

    $forms = $('#ContactForm, #Cta form');
    if ($forms.length) {
      $('.error-message').hide();
      $forms.each(function(i, form) {
        var $form, $requiredFields, $submit, prefix, requireField;
        $form = $(form);
        $requiredFields = $form.find('input.required');
        $submit = $form.find('input[type=submit]');
        prefix = $form.data('prefix');
        if (prefix) {
          prefix = prefix + "_";
        } else {
          prefix = '';
        }
        requireField = function($input) {
          var $error;
          $error = $input.siblings('.error-message');
          if ($.trim($input.val()) === '') {
            $input.addClass('error');
            $error.show();
            return false;
          } else {
            $input.removeClass('error');
            $error.hide();
            return true;
          }
        };
        $requiredFields.blur(function() {
          return requireField($(this));
        });
        return $form.submit(function(e) {
          var allValid, alternativeSubmitText, normalSubmitText;
          e.preventDefault();
          allValid = true;
          $requiredFields.each(function() {
            if (!requireField($(this))) {
              allValid = false;
            }
            return true;
          });
          if (!allValid) {
            return;
          }
          $(this).find('.error-message').remove();
          normalSubmitText = $submit.attr('value');
          alternativeSubmitText = contactFormI18n.submit_alt;
          $submit.attr('disabled', 'disabled').val(alternativeSubmitText);
          return $.post($form.attr('action') + '.json', $form.serialize(), function(data) {
            $submit.removeAttr('disabled').val(normalSubmitText);
            if (data.errors) {
              $.each(data.errors, function(field, errs) {
                var $field;
                $field = $form.find("input#" + prefix + "contact_form_" + field);
                return $.each(errs, function(i, err) {
                  return $field.after($('<div class="error-message">').text(err).show());
                });
              });
              return $submit.removeAttr('disabled').val(normalSubmitText);
            } else {
              $form.after('<div class="notice">' + contactFormI18n.submitted + '</div>');
              $form.find('input, select').attr('disabled', 'disabled');
              return setTimeout(function() {
                var remove;
                remove = $form.data('remove');
                if (remove) {
                  return $form.parents("#" + remove).remove();
                } else {
                  return $form.remove();
                }
              }, 3000);
            }
          });
        });
      });

      $ContactForm = $('#ContactForm');
      if ($ContactForm.length) {
        if ($ContactForm.find('.alternatives input:checked').length === 0) {
          if (window.location.hash !== '') {
            toCheck = $ContactForm.find(".alternatives input[value=" + (window.location.hash.split('#')[1]) + "]");
          } else {
            toCheck = $ContactForm.find('.alternatives input:first');
          }
          toCheck.attr('checked', 'checked');
        }
      }
      $contactFormName = $('#contact_form_name');
      $contactFormName.change(function() {
        if ($.trim($(this).val()) !== '') {
          $ContactForm.find('.contact__extra').addClass('contact__extra--shown');
          return $contactFormName.unbind('change');
        }
      });
    }

    $('.swipebox').swipebox();
    $slider = $('.slider');
    $slider.slick({
      'accesibility': true,
      'arrows': false,
      'autoplay': true,
      'autoplaySpeed': 5000,
      'dots': true,
      'draggable': false,
      'fade': true
    });
    return $slider.find('.slider__slide').show();
  });

}).call(this);
